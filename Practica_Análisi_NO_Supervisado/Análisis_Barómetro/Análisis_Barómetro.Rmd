---
title: "Análisis_Encuesta_Barómetro_Sanitario"
author: "Guillermo Bonafonte Criado"
date: "31/1/2017"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Cargamos las librerías necesarias

```{r, message=FALSE}
library(data.table) 
library(stringi)
```

```{r}


col_ends <-list(beg = c(1,5,10,12,14,17,18,19,21,24,28,
                          29,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,
                          50,51,52,53,54,55,56,58,60,62,64,65,67,69,70,71,72,73,74,
                          75,76,77,79,80,81,82,83,84,85,86,87,89,91,93,95,97,99,101,
                          103,105,107,109,111,113,115,116,118,120,121,122,123,124,
                          125,126,127,128,130,132,133,134,135,136,138,140,141,142,
                          143,144,146,148,150,152,154,156,158,160,161,163,165,166,
                          167,168,169,170,171,172,173,174,175,176,178,180,182,184,
                          186,188,190,192,193,194,195,196,197,198,199,200,201,202,
                          203,204,205,206,207,208,209,210,211,212,213,214,215,216,
                          217,218,219,220,221,222,223,224,225,226,227,228,229,230,
                          231,232,233,234,235,236,237,238,240,241,243,244,246,247,
                          248,250,251,252,253,254,257,258,259,262,265,268,271,274,
                          276,278,279,280,283,284,285,286,288,291,292,293,294,295,
                          296,299,302,305,308,311,314,317,320,323,326,327,328,329,
                          330,333,336,339,342,345,348,351,354,357,359,361,363,364,
                          367,368,369,371,372,373,375,376,378,380,381,383,384,
                          386,387,389,390,392,393),
                  
                  end = c(4,9,11,13,16,17,18,20,23,27,28,30,31,
                          33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,
                          48,49,50,51,52,53,54,55,57,59,61,63,64,66,68,
                          69,70,71,72,73,74,75,76,78,79,80,81,82,83,84,
                          85,86,88,90,92,94,96 ,98,100,102,104,106,108,
                          110,112,114,115,117,119,120,121,122,123,124,
                          125,126,127,129,131,132,133,134,135,137,139,
                          140,141,142,143,145,147,149,151,153,155,157,
                          159,160,162,164,165,166,167,168,169,170,171,
                          172,173,174,175,177,179,181,183,185,187,189,
                          191,192,193,194,195,196,197,198,199,200,201,
                          202,203,204,205,206,207,208,209,210,211,212,
                          213,214,215,216,217,218,219,220,221,222,223,
                          224,225,226,227,228,229,230,231,232,233,234,
                          235,236,237,239,240,242,243,245,246,247,249,
                          250,251,252,253,256,257,258,261,264,267,270,
                          273,275,277,278,279,282,283,284,285,287,290,
                          291,292,293,294,295,298,301,304,307,310,313,
                          316,319,322,325,326,327,328,329,332,335,338,
                          341,344,347,350,353,356,358,360,362,363,366,
                          367,368,370,371,372,374,375,377,379,380,382,
                          383,385,386,388,389,391,392,397),
                  
                  names = c("ESTU", "CUES", "CCAA", "PROV", "MUN", "TAMUNI",
                            "AREA", "DISTR", "SECCION", "ENTREV", "OLA", "P1",
                            "P2", "P3", "P4", "P4A", "P4B", "P501", "P502",
                            "P503", "P504", "P505", "P6", "P701", "P702",
                            "P703", "P704", "P705", "P706", "P707", "P801",
                            "P802", "P803", "P804", "P9", "P10", "P1101",
                            "P1102", "P1103", "P1104", "P12", "P12A01", "P12A02",
                            "P12B", "P12C", "P12D", "P12E", "P12F", "P12G",
                            "P12H", "P13", "P13A", "P14A01", "P14A02", "P14A03",
                            "P14A04", "P14B01", "P14B02", "P14B03", "P14B04",
                            "P14C01", "P14C02", "P14C03", "P14C04", "P1501",
                            "P1502", "P1503", "P1504", "P1505", "P1506", "P1507",
                            "P1508", "P1509", "P1510", "P16", "P16A01", "P16A02",
                            "P16B", "P16C", "P16D", "P16E", "P16F", "P16G",
                            "P16H", "P17", "P17A01", "P17A02", "P17B", "P17C",
                            "P17D", "P17E", "P17F01", "P17F02", "P17G", "P17H",
                            "P17I", "P17J", "P1801", "P1802", "P1803", "P1804",
                            "P1805", "P1806", "P1807", "P1808", "P19", "P19A01",
                            "P19A02", "P19B", "P19C", "P19D", "P19E", "P19F01",
                            "P19F02", "P19F03", "P19F04", "P19F05", "P19G",
                            "P19H", "P2001", "P2002", "P2003", "P2004", "P2005",
                            "P2006", "P2007", "P2008", "P21", "P2201", "P2202",
                            "P2203", "P2204", "P2205", "P23", "P24", "P25",
                            "P26", "P2701", "P2702", "P2703", "P2801", "P2802", 
                            "P2803", "P2804", "P2805", "P2806", "P2807", "P2901",
                            "P2902", "P2903", "P2904", "P2905", "P30", "P31",
                            "P31A01", "P31A02", "P31A03", "P31A04", "P31B", 
                            "P32", "P32A", "P32B", "P33", "P3401", "P3402", 
                            "P3403", "P3404", "P35", "P36", "P36A", "P36B",
                            "P3701", "P3702", "P38", "P39", "P39A", "P40", 
                            "P41", "P42", "P43", "P43A", "P44", "P45", "P46", 
                            "P47", "P48", "P49", "P49A","P50", "P51", "P51A", 
                            "P52", "P52A", "P53", "P54", "P55", "P55A", "P55B", 
                            "P55C", "P55D", "P56", "P56A", "P56B", "P57", 
                            "P5801", "P5802", "P5803", "P5804", "P5901", 
                            "P5902", "P5903", "P5904", "P5905", "P6001", 
                            "P6002", "P6003", "P6004", "P6005", "P61", "P62", 
                            "P63", "P64", "I1", "I2", "I3", "I4", "I5", "I6",
                            "I7", "I8", "I9", "E101", "E102", "E103", "E2",
                            "E3", "E4", "C1", "C1A", "C2", "C2A", "C2B", "C3",
                            "C4", "RECUERDO", "ESTUDIOS", "OCUMAR11", "RAMA09",
                            "OCUPAPAD", "RAMAPAD", "OCUPAMAD", "RAMAMAD", 
                            "CONDICION11", "ESTATUS", "PESO")
      )
    


barometro <- as.data.frame(fread("DA8815.txt", 
                           header = FALSE, sep = "\n")[, lapply(1:(length(col_ends$beg)),
                           function(ii) stri_sub(V1, col_ends$beg[ii], 
                                                 col_ends$end[ii]))])     
names(barometro) <- col_ends$names      
barometro <- subset(barometro,  ESTU==3058) 


# remove cols with unique value 

ind_ <- which(apply(barometro, 2, function(x) length(unique(x)))==1)
barometro <- barometro[,-ind_] 
cols <- 7:ncol(barometro)  
barometro[,cols] = lapply(barometro[,cols], function(x) as.numeric(as.character(x)))
```